<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kernel on circleous</title><link>https://blog.circleo.us/tags/kernel/</link><description>Recent content in Kernel on circleous</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Mon, 18 Apr 2022 00:00:00 +0700</lastBuildDate><atom:link href="https://blog.circleo.us/tags/kernel/index.xml" rel="self" type="application/rss+xml"/><item><title>crewctf 2022 - qKarachter</title><link>https://blog.circleo.us/posts/crewctf-2022-qkarachter/</link><pubDate>Mon, 18 Apr 2022 00:00:00 +0700</pubDate><guid>https://blog.circleo.us/posts/crewctf-2022-qkarachter/</guid><description>&lt;p&gt;qKarachter was a kernel challenge, which provided a misc device that can be interacted with ioctl(2).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#bb9af7"&gt;typedef&lt;/span&gt; &lt;span style="color:#bb9af7"&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#41a6b5"&gt;unsigned&lt;/span&gt; &lt;span style="color:#41a6b5"&gt;int&lt;/span&gt; length;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#41a6b5"&gt;unsigned&lt;/span&gt; &lt;span style="color:#41a6b5"&gt;int&lt;/span&gt; idx;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#41a6b5"&gt;char&lt;/span&gt;&lt;span style="color:#9ece6a;font-weight:bold"&gt;*&lt;/span&gt; data; &lt;span style="color:#414868;font-style:italic"&gt;// ptr to char[144]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;} req;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#41a6b5"&gt;int&lt;/span&gt; &lt;span style="color:#7aa2f7"&gt;handle_ioctl&lt;/span&gt;(&lt;span style="color:#bb9af7"&gt;__int64&lt;/span&gt; a1, &lt;span style="color:#41a6b5"&gt;int&lt;/span&gt; cmd, req &lt;span style="color:#9ece6a;font-weight:bold"&gt;*&lt;/span&gt;arg) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; req &lt;span style="color:#9ece6a;font-weight:bold"&gt;*&lt;/span&gt;req;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; req &lt;span style="color:#9ece6a;font-weight:bold"&gt;*&lt;/span&gt;_req;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#41a6b5"&gt;int&lt;/span&gt; result;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;mutex_lock&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;mutex); &lt;span style="color:#414868;font-style:italic"&gt;// global lock
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; req &lt;span style="color:#9ece6a;font-weight:bold"&gt;=&lt;/span&gt; (req &lt;span style="color:#9ece6a;font-weight:bold"&gt;*&lt;/span&gt;)&lt;span style="color:#7aa2f7"&gt;kmem_cache_alloc_trace&lt;/span&gt;(kmalloc_caches[&lt;span style="color:#e0af68"&gt;4&lt;/span&gt;], &lt;span style="color:#e0af68"&gt;3264LL&lt;/span&gt;, &lt;span style="color:#e0af68"&gt;16LL&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;if&lt;/span&gt; (&lt;span style="color:#9ece6a;font-weight:bold"&gt;!&lt;/span&gt;req) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;printk&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;str_malloc_failed);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;mutex_unlock&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;return&lt;/span&gt; &lt;span style="color:#9ece6a;font-weight:bold"&gt;-&lt;/span&gt;ENOMEM;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; _req &lt;span style="color:#9ece6a;font-weight:bold"&gt;=&lt;/span&gt; req;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;if&lt;/span&gt; (&lt;span style="color:#7aa2f7"&gt;copy_from_user&lt;/span&gt;(req, arg, &lt;span style="color:#e0af68"&gt;16LL&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;printk&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;str_copy_from_user_failed);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;return&lt;/span&gt; &lt;span style="color:#9ece6a;font-weight:bold"&gt;-&lt;/span&gt;EAGAIN;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;switch&lt;/span&gt; (cmd) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;case&lt;/span&gt; &lt;span style="color:#e0af68"&gt;0x1338&lt;/span&gt;&lt;span style="color:#9ece6a;font-weight:bold"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; result &lt;span style="color:#9ece6a;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#7aa2f7"&gt;readData&lt;/span&gt;(_req);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;goto&lt;/span&gt; _success;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;case&lt;/span&gt; &lt;span style="color:#e0af68"&gt;0x1339&lt;/span&gt;&lt;span style="color:#9ece6a;font-weight:bold"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; result &lt;span style="color:#9ece6a;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#7aa2f7"&gt;delData&lt;/span&gt;(_req&lt;span style="color:#9ece6a;font-weight:bold"&gt;-&amp;gt;&lt;/span&gt;idx);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;goto&lt;/span&gt; _success;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;case&lt;/span&gt; &lt;span style="color:#e0af68"&gt;0x1337&lt;/span&gt;&lt;span style="color:#9ece6a;font-weight:bold"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; result &lt;span style="color:#9ece6a;font-weight:bold"&gt;=&lt;/span&gt; &lt;span style="color:#7aa2f7"&gt;addData&lt;/span&gt;(_req);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;goto&lt;/span&gt; _success;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;default&lt;/span&gt;&lt;span style="color:#9ece6a;font-weight:bold"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;printk&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;str_invalid_choice);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;mutex_unlock&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;return&lt;/span&gt; &lt;span style="color:#9ece6a;font-weight:bold"&gt;-&lt;/span&gt;EINVAL;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#9ece6a"&gt;_success&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;kfree&lt;/span&gt;(_req);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#7aa2f7"&gt;mutex_unlock&lt;/span&gt;(&lt;span style="color:#9ece6a;font-weight:bold"&gt;&amp;amp;&lt;/span&gt;mutex);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#bb9af7"&gt;return&lt;/span&gt; result;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Data are created in &lt;code&gt;addData&lt;/code&gt; with size of kmalloc-128 and the pointer to it are stored in global array &lt;code&gt;ptrArr&lt;/code&gt;.&lt;/p&gt;</description></item><item><title>A Long Rant and FBCTF 2019 - kpets</title><link>https://blog.circleo.us/posts/a-long-rant-and-fbctf-2019-kpets/</link><pubDate>Sat, 29 Jun 2019 00:00:00 +0700</pubDate><guid>https://blog.circleo.us/posts/a-long-rant-and-fbctf-2019-kpets/</guid><description>&lt;h2 id="rant"&gt;rant&lt;/h2&gt;
&lt;p&gt;After reading auxy blog about &lt;a href="http://www.auxy.xyz/tutorial/2019/06/10/Linux-Exp-Tutorial.html"&gt;linux kernel exploitation tutorial&lt;/a&gt;, I kinda wanted to write this into a blog post. I&amp;rsquo;m still rather new to kernel pwn, I&amp;rsquo;ve been learning this since there is two kernel pwn appearances in secfest CTF around May 2019 &lt;code&gt;xtore&lt;/code&gt; and &lt;code&gt;brainfuck64&lt;/code&gt;. Reason? I need something beside learning classical heap pwn and might be a good mood booster to do another large codebase code review.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;brainfuck64&lt;/code&gt; seems like a classic heap challenge, but in kernelspace. I didn&amp;rsquo;t solve it tho, I literally just started this kernel pwn journey and didn&amp;rsquo;t even know what&amp;rsquo;s this &lt;code&gt;IOCTL&lt;/code&gt; thing. Shortly, after ctf ends, I read &lt;a href="https://kileak.github.io/ctf/2019/secfest-brainfuck64/"&gt;kileak writeup&lt;/a&gt;, seems like my assumption is correct.&lt;/p&gt;</description></item></channel></rss>